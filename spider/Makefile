# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    Makefile                                           :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: joeberle <joeberle@student.42.fr>          +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2024/11/18 11:06:57 by joeberle          #+#    #+#              #
#    Updated: 2024/11/18 17:42:59 by joeberle         ###   ########.fr        #
#                                                                              #
# **************************************************************************** #



#------------------------------------------------------------------------------#
#--------------                       PRINT                       -------------#
#------------------------------------------------------------------------------#

BLACK := \033[90m
RED := \033[31m
GREEN := \033[32m
YELLOW := \033[33m
BLUE := \033[34m
MAGENTA := \033[35m
CYAN := \033[36m
X := \033[0m

SUCCESS := \n\
$(RED)██████████████████████████████████████████████$(X)\n\
$(X)\n\
███████  ███████  █  ██████   ███████  ███████$(X)\n\
█        █     █  █  █     █  █        █     █$(X)\n\
███████  ███████  █  █     █  ███████  ███████$(X)\n\
$(BLACK)______$(X)█  █        █  █     █  █        █   █  $(X)\n\
███████  █        █  ██████   ███████  █    ██$(X)\n\
$(X)\n\
$(RED)██████████████████████████████████████████████$(X)\n\

#------------------------------------------------------------------------------#
#--------------                      GENERAL                      -------------#
#------------------------------------------------------------------------------#

NAME		= spider
PYTHON		= python3
PIP			= pip3
PYINSTALLER	= ~/.local/bin/pyinstaller
SRC			= spider.py

#------------------------------------------------------------------------------#
#--------------                       FLAGS                       -------------#
#------------------------------------------------------------------------------#

PYFLAGS		= --onefile
PIPFLAGS	= install --quiet --user

#------------------------------------------------------------------------------#
#--------------                        DIR                        -------------#
#------------------------------------------------------------------------------#

BUILD_DIR	= build
DIST_DIR	= dist

#------------------------------------------------------------------------------#
#--------------                      DEPENDS                      -------------#
#------------------------------------------------------------------------------#

DEPENDS		= requests \
			beautifulsoup4 \
			fake_useragent \
			colorama \
			urllib3 \
			argparse \
			bs4

#------------------------------------------------------------------------------#
#--------------                      COMPILE                      -------------#
#------------------------------------------------------------------------------#

.PHONY: all setup clean fclean re

all: $(NAME)

setup:
	@echo "$(BLUE)Installing dependencies...$(X)"
	@$(PIP) $(PIPFLAGS) $(DEPENDS)
	@$(PIP) $(PIPFLAGS) pyinstaller

$(NAME): $(SRC)
	@if [ ! -f $(NAME) ] || [ $(SRC) -nt $(NAME) ]; then \
		echo "$(YELLOW)Building binary...$(X)"; \
		$(PYINSTALLER) $(PYFLAGS) $(SRC); \
		mv $(DIST_DIR)/$(NAME) .; \
		echo "$(GREEN)Binary created: ./$(NAME)$(X)"; \
		echo "$(SUCCESS)"; \
	else \
		echo "$(GREEN)Binary is up to date$(X)"; \
	fi

clean:
	@echo "$(RED)Cleaning build files...$(X)"
	@rm -rf $(BUILD_DIR) $(DIST_DIR) *.spec __pycache__ 2>/dev/null || true

fclean: clean
	@echo "$(RED)Full cleanup...$(X)"
	@rm -f $(NAME) 2>/dev/null || true

re: fclean all